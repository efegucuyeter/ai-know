<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Giriş & Kayıt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        body {
            background: #578FCA;
            background: radial-gradient(circle, rgba(87, 143, 202, 1) 53%, rgba(148, 187, 233, 1) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .main-content {
            flex: 1;
            padding-bottom: 250px;
        }
        .navbar-custom, footer {
            background-color: #3674B5 !important;
        }
        .overlay {
            background: rgba(0, 51, 102, 0.2);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 10px;
        }
        .social-icons {
            text-align: center;
            margin-top: 20px;
        }
        .social-icons i {
            font-size: 26px;
            margin: 0 10px;
            cursor: pointer;
            color: white;
        }
        .form-control {
            margin-bottom: 1.5rem;
            padding-right: 45px;
        }
        .btn-light {
            background-color: white;
            color: #3674B5;
            font-weight: bold;
        }
        .btn-light:hover {
            background-color: #2c5d95;
            color: white;
        }
        .password-wrapper {
            position: relative;
        }
        .password-wrapper i {
            position: absolute;
            right: 15px;
            top: 30%;
            transform: translateY(-50%);
            font-size: 20px;
            cursor: pointer;
            color: gray;
        }
        .password-wrapper i:hover {
            color: black;
        }
        .card-spacer {
            margin-top: 150px;
        }
        footer {
            color: white;
            padding: 20px 0;
            margin-top: auto;
            width: 100%;
        }
        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }
        .footer-box {
            background-color: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
            text-align: center;
        }
        .footer-box h5 {
            color: #0f3762;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .footer-box p {
            color: #ecf0f1;
            margin-bottom: 0;
            font-size: 0.9rem;
        }
        .footer-links {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .footer-links p {
            margin-bottom: 5px;
        }
        .footer-links a {
            color: #3674B5;
            text-decoration: none;
            margin: 0 8px;
        }
        .footer-links a:hover {
            text-decoration: underline;
        }
        h4 {
            color: #2c5d95;
            margin-bottom: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="container">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-dark navbar-custom mt-3 rounded">
                <div class="container-fluid">
                    <a class="navbar-brand" href="index.html">Ana Sayfa</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item"><a class="nav-link" href="#">Nasıl Çalışır?</a></li>
                            <li class="nav-item"><a class="nav-link" href="login.html">Giriş Yap</a></li>
                        </ul>
                    </div>
                </div>
            </nav>
            
            <!-- İçerik -->
            <div class="row justify-content-center card-spacer">
                <div class="col-md-8">
                    <div class="row overlay text-white g-4">
                        <!-- Giriş Yap -->
                        <div class="col-md-6 d-flex flex-column">
                            <h4>Giriş Yap</h4>
                            <form id="loginForm">
                                <input type="email" id="loginEmail" class="form-control" placeholder="example@mail.com" required>
                                <div class="password-wrapper">
                                    <input type="password" class="form-control" id="loginPassword" placeholder="Şifre" required>
                                    <i class="bi bi-eye-slash" onclick="togglePassword('loginPassword', this)"></i>
                                </div>
                                <div class="mt-auto">
                                    <button type="submit" class="btn btn-light w-100">GİRİŞ YAP</button>
                                </div>
                            </form>
                            <div class="social-icons">
                                <i class="bi bi-apple"></i>
                                <i class="bi bi-google"></i>
                            </div>
                        </div>
                        
                        <!-- Kayıt Ol -->
                        <div class="col-md-6 d-flex flex-column border-start">
                            <h4>Kayıt Ol</h4>
                            <form id="registerForm">
                                <input type="text" id="registerUsername" class="form-control" placeholder="Kullanıcı Adı" required>
                                <input type="email" id="registerEmail" class="form-control" placeholder="example@mail.com" required>
                                <div class="password-wrapper">
                                    <input type="password" class="form-control" id="registerPassword" placeholder="Şifre" required>
                                    <i class="bi bi-eye-slash" onclick="togglePassword('registerPassword', this)"></i>
                                </div>
                                <div class="password-wrapper">
                                    <input type="password" class="form-control" id="confirmPassword" placeholder="Şifre Tekrar" required>
                                    <i class="bi bi-eye-slash" onclick="togglePassword('confirmPassword', this)"></i>
                                </div>
                                <div class="mt-auto">
                                    <button type="submit" class="btn btn-light w-100">KAYIT OL</button>
                                </div>
                            </form>
                            <div class="social-icons">
                                <i class="bi bi-apple"></i>
                                <i class="bi bi-google"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-box">
                    <h5>Aktif Kullanıcılar</h5>
                    <p>1920+ Kullanıcı</p>
                </div>
                <div class="footer-box">
                    <h5>Testler</h5>
                    <p>1500+ Test</p>
                </div>
                <div class="footer-box">
                    <h5>Çözülen Testler</h5>
                    <p>1400+ Test Çözüldü</p>
                </div>
                <div class="footer-box">
                    <h5>Son Kayıtlı Üye</h5>
                    <p>Ahmet Yılmaz (ahmet@mail.com)</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/api.js"></script>
    <script>
        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("bi-eye-slash");
                icon.classList.add("bi-eye");
            } else {
                input.type = "password";
                icon.classList.remove("bi-eye");
                icon.classList.add("bi-eye-slash");
            }
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await AuthAPI.login(email, password);
                showAlert('Giriş başarılı! Yönlendiriliyorsunuz...', 'success');
                setTimeout(() => {
                    window.location.href = 'quiz.html';
                }, 1500);
            } catch (error) {
                showAlert('Giriş başarısız! Email veya şifre hatalı.', 'danger');
            }
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showAlert('Şifreler eşleşmiyor!', 'danger');
                return;
            }
            
            try {
                const response = await AuthAPI.register(email, username, password);
                showAlert('Kayıt başarılı! Şimdi giriş yapabilirsiniz.', 'success');
                
                // Form temizle
                document.getElementById('registerForm').reset();
            } catch (error) {
                if (error.message.includes('400')) {
                    showAlert('Bu email veya kullanıcı adı zaten kullanılıyor!', 'danger');
                } else {
                    showAlert('Kayıt başarısız! Lütfen tekrar deneyin.', 'danger');
                }
            }
        });

        // Eğer kullanıcı zaten giriş yapmışsa quiz sayfasına yönlendir
        if (TokenManager.isLoggedIn()) {
            window.location.href = 'quiz.html';
        }

        // Sayfa yüklendiğinde istatistikleri yükle
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadStatistics();
            } catch (error) {
                console.error('İstatistikler yüklenemedi:', error);
            }
        });

        async function loadStatistics() {
            try {
                const stats = await StatisticsAPI.getStatistics();
                updateFooterStatistics(stats);
            } catch (error) {
                console.error('İstatistikler yüklenemedi:', error);
            }
        }

        function updateFooterStatistics(stats) {
            const footerBoxes = document.querySelectorAll('.footer-box');
            
            if (footerBoxes[0]) {
                footerBoxes[0].innerHTML = `
                    <h5>Aktif Kullanıcılar</h5>
                    <p>${stats.total_users}+ Kullanıcı</p>
                `;
            }
            
            if (footerBoxes[1]) {
                footerBoxes[1].innerHTML = `
                    <h5>Testler</h5>
                    <p>${stats.total_quizzes}+ Test</p>
                `;
            }
            
            if (footerBoxes[2]) {
                footerBoxes[2].innerHTML = `
                    <h5>Çözülen Testler</h5>
                    <p>${stats.total_attempts}+ Test Çözüldü</p>
                `;
            }
            
            if (footerBoxes[3] && stats.latest_user) {
                footerBoxes[3].innerHTML = `
                    <h5>Son Kayıtlı Üye</h5>
                    <p>${stats.latest_user}</p>
                `;
            }
        }
    </script>
</body>
</html>